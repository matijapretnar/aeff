operation stop : int
operation go : int

let rec waitForStop threadID =
  promise (stop threadID' when threadID = threadID' ->
    let p = promise (go threadID' when threadID = threadID' ->
      <<()>>
    ) in
    await p until <<_>> in
    waitForStop threadID
  )

run
  waitForStop 1; 1 + 1 + 1 + 1 + 1

run
  waitForStop 2; 10 + 10 + 10 + 10 + 10
